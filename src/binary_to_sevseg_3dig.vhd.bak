library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.STD_LOGIC_UNSIGNED.ALL;

entity binary_to_sevseg_3dig is
    generic (
        N : natural := 10  -- width of binary input
    );
    port (
        clk      : in  std_logic;
        rst_n    : in  std_logic;  -- active low asynchronous reset
        bin_in   : in  std_logic_vector(N-1 downto 0);  -- 10-bit binary input (0-999)
        seg_units    : out std_logic_vector(6 downto 0); -- a..g active LOW
        seg_tens     : out std_logic_vector(6 downto 0);
        seg_hundreds : out std_logic_vector(6 downto 0)
    );
end binary_to_sevseg_3dig;

architecture Behavioral of binary_to_sevseg_3dig is

    -- Declare the SEVEN_SEG component
    component SEVEN_SEG is
        port ( 
            Data   : in  std_logic_vector(3 downto 0);  -- Expected within 0..9
            Pol    : in  std_logic;                      -- '0' if active LOW
            Segout : out std_logic_vector(6 downto 0)    -- Segments A, B, C, D, E, F, G
        );
    end component;

    -- Declare the BCD counter component (CompCodageBCD)
    component CompCodageBCD is
        Port (u, d, c, m : out std_logic_vector(3 downto 0); 
              out1Hz : in std_logic; 
              reset : in std_logic);
    end component;

    -- Signals to hold the BCD digits for units, tens, and hundreds
    signal bin_units   : std_logic_vector(3 downto 0);   -- Units (0-9)
    signal bin_tens    : std_logic_vector(3 downto 0);   -- Tens (0-9)
    signal bin_hundreds: std_logic_vector(3 downto 0);   -- Hundreds (0-9)
    signal reset      : std_logic;  -- Reset signal for BCD counter

begin

    -- Instantiate the CompCodageBCD component for BCD counting
    U1 : CompCodageBCD
        port map (
            u => bin_units,    -- Units BCD
            d => bin_tens,     -- Tens BCD
            c => bin_hundreds, -- Hundreds BCD
            m => open,          -- Thousands BCD (not needed in this 0-999 case)
            out1Hz => clk,   -- Frequency input (triggering the counting process)
            reset => rst_n     -- Active low reset
        );

    -- Instantiate the SEVEN_SEG component for each digit (units, tens, hundreds)
    U2 : SEVEN_SEG
        port map (
            Data   => bin_units,
            Pol    => '0',          -- Active LOW
            Segout => seg_units
        );

    U3 : SEVEN_SEG
        port map (
            Data   => bin_tens,
            Pol    => '0',          -- Active LOW
            Segout => seg_tens
        );

    U4 : SEVEN_SEG
        port map (
            Data   => bin_hundreds,
            Pol    => '0',          -- Active LOW
            Segout => seg_hundreds
        );

end Behavioral;
